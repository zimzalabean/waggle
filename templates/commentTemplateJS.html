{% macro comment_temp(comment, user_id, pageIsNotPost) -%}


<div class="comment-wrap">
    <div class="comment-header">
        <div class = 'avator-comment'>
          <img src="{{url_for('profilePic',user_id=comment.commentor_id)}}" alt="{{comment.commentor_id}}" class = 'img-profile'>
        </div>
      <div class="comment-header-info">
        <div><a href="{{url_for('user', username=comment.username)}}"><span class = 'author'> @{{comment.username}}</span></a> <span style = 'font-size: 10px;'> replied:</span></div>        
        <div><span class = 'posted-date'>{{comment.posted_date}}</span></div>
    </div>      
    </div>
    
    <div class="comment-img-wrap" onclick= "window.location.href = '{{url_for('addReply', comment_id=comment.comment_id)}}#main-comment';">
      <p> {{comment.content}}</p>
    </div>

    <div class="post-info-counts">
      
      <div class="comments"  style = 'display: flex; align-items: center;'>
        <div class = 'small-circle'>          
          <button  onclick ="showReply('{{comment.comment_id}}')">
          <svg class="feather feather-message-circle sc-dnqmqq jxshSx" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"></path></svg>
          </button>
        </div>
        <div class="comment-count">{{comment.replies}}</div>
      </div>

      <div class="metric {{'selected' if comment.isLiked}}"  id="comment-likes-{{comment.comment_id}}" style = 'display: flex; align-items: center;'>
        <div class = 'small-circle'>
          <form class = "like-count-comment" method= 'POST' action="{{url_for('likeComment')}}" > 
          {% if comment.isLiked %}
            <button id = 'comment-Like{{comment.comment_id}}' onclick ="likeComment('{{comment.comment_id}}','{{comment.commentor_id}}')">
            <svg class="feather feather-heart sc-dnqmqq jxshSx" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg>
            </button>
          {% else %}
            <button id = 'comment-Like{{comment.comment_id}}' onclick ="likeComment('{{comment.comment_id}}','{{comment.commentor_id}}')">
            <svg class="feather feather-heart sc-dnqmqq jxshSx" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg>
            </button>
          {% endif %}  
          </form>
        </div>
    
        <div><span id="comment-likes-count-{{comment.comment_id}}">{{comment.likes}}</span></div>
      </div>
     
      <div class="action">
        <button>
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-three-dots" viewBox="0 0 16 16">
            <path d="M3 9.5a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3zm5 0a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3zm5 0a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3z"/>
          </svg>
        </button>
      </div>
      {% if pageIsNotPost %}
      <a href="{{url_for('post', post_id=comment.post_id)}}" class="btn btn-sm btn-outline-primary" style="float:right">View Post</a>
      {% endif %}
    </div>
</div>
<div id="myDropdown_reply_{{comment.comment_id}}" class="dropdown-reply">   
    <form method='post' action="{{url_for('addReply', comment_id = comment.comment_id)}}" >     
      <div class = 'comment-header' style = 'align-items: center; '>
        <div class = 'avator-comment'>
            <img src="{{url_for('profilePic',user_id=user_id)}}" alt="{{user_id}}" class = 'img-profile'>    
        </div > 
        <div><input type ='text' class ='write-text' name="comment_content"  placeholder="Reply to this comment" ></div>
        <div><input type="submit" name="submit" class = 'search-filter' value="Reply"></div>
    </div>
    </form>
</div> 


<script>
    function showReply(cid) {
            event.preventDefault();
            document.getElementById("myDropdown_reply_"+cid).classList.toggle("show-reply");
            console.log(document.getElementById("myDropdown_reply_"+cid));
        }


    function likeComment(comment_id, commentor_id) {   
        $.ajax({
                type: "POST",
                url: "/likeComment/",
                data: JSON.stringify({'comment_id': comment_id, 'commentor_id': commentor_id}),
                contentType: 'application/json; charset=utf-8',
                dataType: 'json',
                async: true,
                success: function (resp) {
                    console.log(resp);
                    var comment_id = resp.comment_id;
                    var likes = resp.likes;
                    var kind = resp.kind;
                    $("#comment-likes-count-"+comment_id).text(likes);
                    if (kind =='Like') {
                          document.getElementById("comment-likes-"+comment_id).classList.toggle("selected");
                        }
                    else if (kind == 'Unlike'){
                            document.getElementById("comment-likes-"+comment_id).classList.remove('selected');
                    };  
                }
            });  event.preventDefault();
    }
    function showDropdown(pid) {
            document.getElementById("myDropdown_"+pid).classList.toggle("display");
            console.log(document.getElementById("myDropdown_"+pid));
        }

        // Close the dropdown if the user clicks outside of it
        window.onclick = function(event) {
            if (!event.target.matches('.dropbtn')) {
                var dropdowns = document.getElementsByClassName("dropdown-content");
                var i;
                for (i = 0; i < dropdowns.length; i++) {
                    var openDropdown = dropdowns[i];
                    if (openDropdown.classList.contains('show')) {
                        openDropdown.classList.remove('show');
                    }
                }
            }}


</script>

{%- endmacro%}